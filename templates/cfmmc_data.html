{% extends 'base/base.html' %}
{% block title %}投资者查询服务系统-中国期货市场监控中心{% endblock %}
{% block script %}
<style>
tr{border:1px solid #999;}
td,th{ border:0px;height:40px; }
</style>
<script language="JavaScript">
   javascript:window.history.forward(1);
</script>
{% endblock %}
{% block center_cen %}
{% load staticfiles %}

<script type="text/javascript" src="{% static 'js/echarts.min.js' %}"></script>



<div align="center">
    <form action="{% url 'cfmmc_data' %}" method="GET">
开始日期：<input type="date" name="start_date" value="{{start_date}}">&nbsp;&nbsp;
结束日期：<input type="date" name="end_date" value="{{end_date}}">&nbsp;&nbsp;
<input type="submit" value="下载数据">&nbsp;&nbsp;
        <a href="{% url 'cfmmc_logout' %}" style="color:blue;">退出期货监控系统</a>
</form>
<br/><hr/><br/>
    <form action="" method="POST" id="cfmmc_huice_post">
开始日期：<input type='date' name="start_date" value={{start_date}} id='start_date'>&nbsp;&nbsp;结束日期：<input type='date' name="end_date" value={{end_date}} id='end_date'>&nbsp;&nbsp;
{% csrf_token %}
        <input type="hidden" name="host" value="{{ trade.0.12 }}">
    <input type="button" onclick="javascript:request('data')"  value="原数据">&nbsp;&nbsp;
     <input type="button" onclick="javascript:request('tu')"  value="统计图">

</form><br/><br/>
    <div align="center">
    <table border="1">
        <tr><th>合约&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th><th>成交序号&nbsp;&nbsp;&nbsp;&nbsp;</th><th>成交时间&nbsp;&nbsp;</th><th>买/卖&nbsp;&nbsp;</th><th>投机/套保&nbsp;&nbsp;</th>
            <th>成交价&nbsp;&nbsp;</th><th>手数&nbsp;&nbsp;</th><th>成交额&nbsp;&nbsp;</th><th>开/平&nbsp;&nbsp;</th><th>手续费&nbsp;&nbsp;</th>
            <th>平仓盈亏&nbsp;&nbsp;</th><th>实际成交日期&nbsp;&nbsp;&nbsp;&nbsp;</th><th>帐号&nbsp;&nbsp;&nbsp;&nbsp;</th><th>交易日期&nbsp;&nbsp;</th></tr>
        {% for i in trade %}
        <tr><td>{{i.0}}</td><td>{{i.1}}</td><td>{{i.2}}</td><td>{{i.3}}</td><td>{{i.4}}</td>
            <td>{{i.5}}</td><td>{{i.6}}</td><td>{{i.7}}</td><td>{{i.8}}</td><td>{{i.9}}</td>
            <td>{{i.10}}</td><td>{{i.11}}</td><td>{{i.12|truncatechars:9}}</td><td>{{i.13}}</td>
        </tr>
        {% endfor %}
    </table>

    </div>


</div>
<script>
    var success = '{{success}}';
    var user_name = '{{user_name}}'!='None';
    var is_cfmmc_login = '{{is_cfmmc_login}}';
    if(user_name && success=='success' && confirm('是否希望保存用户信息到我的账户，以便下次登录？')){

			$.get("{% url 'cfmmc_save' %}",{"type":"save"},function(res){
			    if(res=='yes'){
			        alert('保存成功!');
			    }else{
			        alert('保存失败!');
			    }
			});
    }
    if(is_cfmmc_login=='no'){
        var host=prompt("您没有登录期货监控系统，如果您不希望登录期货监控系统，请在此输入您的用户名查询您之前保存的数据：");
        if(host!=null && host.trim()!=''){
            location.href="{% url 'cfmmc_data_page' %}?host="+host;
        }
    }
    function request(type){
        var start_date=$("#start_date").val();
        var end_date=$("#end_date").val();
        if(type=='data'){
            location.href="{% url 'cfmmc_data_page' %}?start_date="+start_date+"&end_date="+end_date;
        }else if(type=='tu'){
            var post = $("#cfmmc_huice_post");
            post.attr('action','{% url 'cfmmc_huice' %}');
            post.attr('target','_blank');
            post.submit();
        }
    }

</script>
{% endblock %}
